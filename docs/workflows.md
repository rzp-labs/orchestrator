# Workflows

Available workflows in Orchestrator.

## Overview

Orchestrator provides AI-powered workflows for tactical product development tasks. Each workflow connects to external tools, delegates analysis to specialized agents, and automates repetitive tasks.

**Current workflows**:
- **Support Triage** - Automated ticket investigation and priority assessment

## Support Triage Workflow

Automates investigation of support tickets in Linear.

### What It Does

1. **Fetches ticket** from Linear using GraphQL API
2. **Analyzes validity** - Delegates to `analysis-expert` agent
   - Is this a valid bug/issue?
   - Is it actionable (sufficient info)?
   - What additional context is needed?
3. **Assesses severity** - Delegates to `bug-hunter` agent
   - Severity level (P0/P1/P2/P3)
   - Complexity estimate (simple/medium/complex)
   - Required expertise areas
4. **Updates Linear** - Adds AI analysis as comment and sets priority

### Usage

**Basic usage**:
```bash
uv run orchestrator triage <ticket-id>
```

**Example**:
```bash
uv run orchestrator triage ABC-123
```

**Expected output**:
```
Fetching ticket ABC-123...
✓ Ticket fetched: "User login fails with 500 error"

Analyzing validity...
✓ Validity analysis complete (12s)
  - Valid issue: Yes
  - Actionable: Yes
  - Missing context: None

Assessing severity...
✓ Severity assessment complete (8s)
  - Priority: P1 (High)
  - Complexity: Medium
  - Expertise: Backend, Database

Updating Linear...
✓ Comment added
✓ Priority set to P1

✓ Triage complete for ABC-123 (23s total)
```

### When to Use

**Use triage workflow when**:
- Support ticket needs investigation
- Technical context required for priority decision
- Volume of tickets makes manual triage time-prohibitive
- PM needs engineer-level analysis without engineer availability

**Don't use when**:
- Ticket is straightforward (obvious priority/validity)
- Immediate response needed (triage takes 20-30 seconds)
- Ticket lacks basic information (LLM can't analyze empty descriptions)

### How It Works

#### Step 1: Fetch Ticket

```python
# Executes via Linear GraphQL API
ticket_data = fetch_issue(ticket_id)
```

Retrieves full ticket data including:
- Title and description
- Current priority and state
- Team information
- Reporter information

#### Step 2: Validity Analysis

Delegates to `analysis-expert` agent:

```python
validity_result = await run_agent(
    agent_name="analysis-expert",
    task_description=f"""
    Analyze this support issue for validity and actionability:

    {ticket_json}

    Determine:
    1. Is this a valid bug/issue?
    2. Is it actionable (sufficient info)?
    3. What additional context is needed?
    """
)
```

Agent response includes:
- **is_valid**: Boolean - whether issue is legitimate
- **is_actionable**: Boolean - whether enough info to act
- **missing_context**: List of additional info needed
- **reasoning**: Explanation of determination

#### Step 3: Severity Assessment

Delegates to `bug-hunter` agent:

```python
severity_result = await run_agent(
    agent_name="bug-hunter",
    task_description=f"""
    Estimate complexity and severity of this issue:

    {ticket_json}

    Validity analysis: {validity_result}

    Provide:
    1. Severity (P0/P1/P2/P3)
    2. Estimated complexity (simple/medium/complex)
    3. Required expertise areas
    """
)
```

Agent response includes:
- **severity**: P0 (critical) through P3 (low)
- **complexity**: Simple/Medium/Complex
- **required_expertise**: List of skills needed
- **reasoning**: Explanation of assessment

#### Step 4: Update Linear

Updates ticket with AI analysis:

```python
priority_level = severity_to_priority(severity.severity)
update_issue(ticket_id, priority_level, comment)
```

Comment format:
```markdown
## AI Triage Analysis

**Validity**: Valid, Actionable
**Severity**: P1 (High Priority)
**Complexity**: Medium
**Required Expertise**: Backend, Database

### Analysis
[Reasoning from agents]

### Recommendations
[Next steps from agents]

---
*Generated by Orchestrator*
```

### Error Handling

**Ticket not found**:
```
Error: Ticket ABC-123 not found
Verify ticket ID is correct and accessible with linear-cli
```

**Linear API failure**:
```
Error: Linear API request failed
Check LINEAR_API_KEY environment variable is set
```

**Agent delegation timeout**:
```
Warning: Agent analysis timed out (>60s)
Retrying with simpler prompt...
```

**Invalid JSON response**:
```
Warning: Agent returned invalid JSON
Using defensive parsing to extract data...
```

All errors are logged to `logs/triage_<ticket-id>.log` for debugging.

### Performance

**Typical execution time**: 20-30 seconds
- Fetch ticket: 2-3 seconds
- Validity analysis: 10-15 seconds
- Severity assessment: 8-12 seconds
- Update Linear: 2-3 seconds

**Optimization**:
- Analyses run in parallel where possible
- Timeout limits prevent hanging (60 seconds max per agent)

### Metrics

Hooks automatically collect metrics in `logs/triage_metrics.jsonl`:

```json
{
  "ticket_id": "ABC-123",
  "duration": 23.5,
  "agents_used": ["analysis-expert", "bug-hunter"],
  "success": true,
  "timestamp": "2025-10-26T10:30:00Z"
}
```

Used for:
- Performance monitoring
- Success rate tracking
- Workflow optimization

## Related Documentation

- **[Architecture](architecture.md)** - How workflows are structured
- **[Adding Workflows](adding_workflows.md)** - Creating new workflows
- **[Hooks & Skills](hooks_and_skills.md)** - Automation patterns
